<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task 6: Top 10 CO₂ Emitters (2020)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 50px; }
    #scatter, #mapA, #mapB { height: 500px; margin-top: 20px; border: 1px solid #ccc; }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      padding: 5px;
      font-size: 12px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>Task 6: Visualization Mockups for Top 10 CO₂ Emitters (2020)</h1>
  <p>Dataset: Top 10 countries by CO₂ emissions in 2020, with energy and renewables context.</p>

  <h2>Alternative A: D3.js Scatter Plot</h2>
  <div id="scatter"></div>

  <h2>Alternative B: Leaflet Map</h2>
  <div id="mapA"></div>

  <h2>Alternative C: Hybrid Leaflet + D3 Overlay</h2>
  <div id="mapB"></div>

  <!-- Dependencies -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
  // === DATA ===
  const data = [
    {"country":"china","region":"Asia & Pacific","co2":9716.77,"energy_consumption":3381.40,"renewables_share":28.40,"lat":35.0,"lon":103.0},
    {"country":"united states","region":"North America","co2":4404.71,"energy_consumption":2045.71,"renewables_share":19.80,"lat":39.8,"lon":-98.6},
    {"country":"india","region":"Asia & Pacific","co2":2191.26,"energy_consumption":908.31,"renewables_share":22.52,"lat":22.0,"lon":79.0},
    {"country":"russia","region":"Europe","co2":1619.08,"energy_consumption":731.35,"renewables_share":20.30,"lat":61.5,"lon":105.3},
    {"country":"japan","region":"Asia & Pacific","co2":979.38,"energy_consumption":386.32,"renewables_share":20.23,"lat":36.2,"lon":138.3},
    {"country":"iran","region":"Middle east","co2":619.06,"energy_consumption":267.55,"renewables_share":6.94,"lat":32.4,"lon":53.7},
    {"country":"germany","region":"Europe","co2":616.99,"energy_consumption":275.47,"renewables_share":44.53,"lat":51.2,"lon":10.5},
    {"country":"south korea","region":"Asia & Pacific","co2":569.77,"energy_consumption":282.75,"renewables_share":7.07,"lat":36.5,"lon":127.9},
    {"country":"indonesia","region":"Asia & Pacific","co2":566.04,"energy_consumption":224.87,"renewables_share":18.31,"lat":-2.5,"lon":118.0},
    {"country":"canada","region":"North America","co2":515.57,"energy_consumption":280.81,"renewables_share":67.72,"lat":56.1,"lon":-106.3}
  ];

  // === Alternative A: D3 Scatter Plot ===
  const scatterWidth = 600, scatterHeight = 500, margin = {top:40, right:40, bottom:60, left:80};
  const svg = d3.select("#scatter")
    .append("svg")
    .attr("width", scatterWidth)
    .attr("height", scatterHeight);

  const x = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.energy_consumption)*1.1])
    .range([margin.left, scatterWidth-margin.right]);

  const y = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.co2)*1.1])
    .range([scatterHeight-margin.bottom, margin.top]);

  const r = d3.scaleSqrt().domain([0, d3.max(data, d=>d.renewables_share)]).range([5,20]);
  const color = d3.scaleOrdinal(d3.schemeTableau10);

  const tooltip = d3.select("body").append("div").attr("class", "tooltip").style("opacity", 0);

  svg.selectAll("circle").data(data).enter()
    .append("circle")
    .attr("cx", d=>x(d.energy_consumption))
    .attr("cy", d=>y(d.co2))
    .attr("r", d=>r(d.renewables_share))
    .attr("fill", d=>color(d.region))
    .on("mouseover", (event,d)=>{
      tooltip.style("opacity",1).html(`<b>${d.country}</b><br>CO₂: ${d.co2}<br>Energy: ${d.energy_consumption}`);
    })
    .on("mousemove", (event)=>{
      tooltip.style("left",(event.pageX+10)+"px").style("top",(event.pageY-20)+"px");
    })
    .on("mouseout", ()=>tooltip.style("opacity",0));

  svg.append("g").attr("transform",`translate(0,${scatterHeight-margin.bottom})`).call(d3.axisBottom(x));
  svg.append("g").attr("transform",`translate(${margin.left},0)`).call(d3.axisLeft(y));
  svg.append("text").attr("x",scatterWidth/2).attr("y",scatterHeight-10).style("text-anchor","middle").text("Energy Consumption (Mtoe)");
  svg.append("text").attr("transform","rotate(-90)").attr("x",-scatterHeight/2).attr("y",20).style("text-anchor","middle").text("CO₂ Emissions (Mt)");

  // === Alternative B: Leaflet Map ===
  const mapA = L.map("mapA").setView([20,0],2);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapA);

  data.forEach(d=>{
    if(d.lat && d.lon){
      L.circleMarker([d.lat,d.lon],{
        radius: Math.sqrt(d.co2)/10,
        fillColor:"red",
        color:"black",
        weight:1,
        fillOpacity:0.6
      }).bindPopup(`<b>${d.country}</b><br>CO₂: ${d.co2}`).addTo(mapA);
    }
  });

  // === Alternative C: Hybrid Leaflet + D3 Overlay ===
  const mapB = L.map("mapB").setView([20,0],2);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapB);

  L.svg().addTo(mapB); // add SVG layer
  const overlay = d3.select("#mapB").select("svg");
  const g = overlay.append("g");

  function updateCircles(){
    const transform = d3.geoTransform({point: function(lon, lat){
      const point = mapB.latLngToLayerPoint(new L.LatLng(lat, lon));
      this.stream.point(point.x, point.y);
    }});
    const path = d3.geoPath().projection(transform);

    const u = g.selectAll("circle").data(data);
    u.enter().append("circle").merge(u)
      .attr("r", d=>Math.sqrt(d.co2)/15)
      .attr("fill","steelblue")
      .attr("stroke","black")
      .attr("opacity",0.6)
      .attr("cx", d=>mapB.latLngToLayerPoint([d.lat,d.lon]).x)
      .attr("cy", d=>mapB.latLngToLayerPoint([d.lat,d.lon]).y)
      .append("title").text(d=>`${d.country}: ${d.co2}`);
  }
  mapB.on("zoomend moveend", updateCircles);
  updateCircles();
  </script>
</body>
</html>
